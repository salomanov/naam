import"./app.min.js";import"./popup.min.js";document.addEventListener("DOMContentLoaded",function(){b()});function b(){typeof window.flsPopup<"u"?(console.log("Popup system loaded, using module system"),c()):(console.log("Popup system not loaded, initializing fallback"),setTimeout(()=>{typeof window.flsPopup>"u"?w():c()},1e3)),window.setPopupContent=function(t){const o=t.closest(".blog__post");if(!o)return;const p={beforeImg:o.querySelector("[data-fls-beforeafter-before] img")?.src,afterImg:o.querySelector("[data-fls-beforeafter-after] img")?.src,title:o.querySelector(".post__title")?.textContent,content:o.querySelector(".post__content")?.innerHTML,category:o.getAttribute("data-category")};window.popupContentData=p,typeof window.flsPopup>"u"&&a()}}function c(){document.addEventListener("beforePopupOpen",function(e){e.detail.popup.targetOpen.selector==="popup_blog"&&g()}),document.addEventListener("afterPopupClose",function(e){e.detail.popup.targetOpen.selector==="popup_blog"&&y()}),document.addEventListener("afterPopupOpen",function(e){e.detail.popup.targetOpen.selector==="popup_blog"&&setTimeout(()=>{m()},300)})}function g(e){const t=window.popupContentData;if(!t){console.warn("No popup content data found");const o=document.activeElement;if(o&&o.classList.contains("post__more")){const p=o.closest(".blog__post");if(p){window.popupContentData={beforeImg:p.querySelector("[data-fls-beforeafter-before] img")?.src,afterImg:p.querySelector("[data-fls-beforeafter-after] img")?.src,title:p.querySelector(".post__title")?.textContent,content:p.querySelector(".post__content")?.innerHTML},i(window.popupContentData),u();return}}return}i(t),u()}function i(e){const t=document.querySelector('[data-fls-popup="popup_blog"]');if(!t)return;const o=t.querySelector("[data-fls-beforeafter-before] img"),p=t.querySelector("[data-fls-beforeafter-after] img"),n=t.querySelector(".post__title"),f=t.querySelector(".post__content"),l=t.querySelector("[data-fls-beforeafter-after]"),r=t.querySelector("[data-fls-beforeafter]"),s=t.querySelector("[data-fls-beforeafter-arrow]");l&&(l.style.display=""),s&&(s.style.visibility="",s.style.display=""),r&&r.classList.remove("no-after"),o&&e.beforeImg&&(o.src=e.beforeImg,o.alt=e.title+" - до"),p&&e.afterImg?(p.src=e.afterImg,p.alt=e.title+" - после"):(l&&(l.style.display="none"),s&&(s.style.visibility="hidden",s.style.display="none"),r&&r.classList.add("no-after")),n&&e.title&&(n.textContent=e.title),f&&e.content&&(f.innerHTML=e.content)}function u(){setTimeout(()=>{typeof window.flsBeforeAfter<"u"&&document.querySelectorAll('[data-fls-popup="popup_blog"] [data-fls-beforeafter]').forEach(t=>{t.removeAttribute("style");const o=t.querySelector("[data-fls-beforeafter-arrow]");o&&o.removeAttribute("style"),window.flsBeforeAfter.initBeforeAfterElement(t)})},100)}function y(){window.popupContentData=null;const e=document.querySelector('[data-fls-popup="popup_blog"]');if(!e)return;const t=e.querySelector("[data-fls-beforeafter-before] img"),o=e.querySelector("[data-fls-beforeafter-after] img"),p=e.querySelector(".post__title"),n=e.querySelector(".post__content"),f=e.querySelector("[data-fls-beforeafter-after]"),l=e.querySelector("[data-fls-beforeafter]"),r=e.querySelector("[data-fls-beforeafter-arrow]");t&&(t.src=""),o&&(o.src=""),p&&(p.textContent=""),n&&(n.innerHTML=""),f&&(f.style.display=""),r&&(r.style.visibility="",r.style.display=""),l&&l.classList.remove("no-after")}function m(){const e=document.querySelector('[data-fls-popup="popup_blog"]');if(!e)return;const o=[e.querySelector("[data-fls-popup-content]"),e.querySelector("[data-fls-popup-body]"),e.querySelector("[data-fls-popup-wrapper]"),e].filter(p=>p!==null).find(p=>{const n=getComputedStyle(p);return(n.overflowY==="auto"||n.overflowY==="scroll")&&p.scrollHeight>p.clientHeight});o&&(o.scrollTop=0,setTimeout(()=>{o.scrollTop!==0&&(o.scrollTop=0)},50),setTimeout(()=>{o.scrollTop!==0&&(o.scrollTop=0,o.scrollTo({top:0,behavior:"smooth"}))},100))}function w(){console.log("Initializing Safari-compatible popup fallback"),document.addEventListener("click",function(e){if(e.target.classList.contains("post__more")||e.target.closest(".post__more")){e.preventDefault();const t=e.target.classList.contains("post__more")?e.target:e.target.closest(".post__more");window.setPopupContent(t),a()}(e.target.closest("[data-fls-popup-close]")||e.target.closest("[data-fls-popup]")&&!e.target.closest("[data-fls-popup-body]"))&&d()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&d()})}function a(){const e=document.querySelector('[data-fls-popup="popup_blog"]');if(!e)return;const t=window.popupContentData;t&&i(t),e.offsetHeight,e.setAttribute("data-fls-popup-active",""),document.documentElement.setAttribute("data-fls-popup-open",""),document.body.style.overflow="hidden",u(),setTimeout(()=>{m()},50)}function d(){const e=document.querySelector('[data-fls-popup="popup_blog"][data-fls-popup-active]');e&&(e.removeAttribute("data-fls-popup-active"),document.documentElement.removeAttribute("data-fls-popup-open"),document.body.style.overflow="",y())}document.addEventListener("click",function(e){const t=e.target.closest('[data-fls-popup-link="popup_blog"][data-fls-popup-source]');if(t){e.preventDefault();const o=t.getAttribute("data-fls-popup-source"),p=t.closest(o);p&&(window.popupContentData={beforeImg:p.querySelector("[data-fls-beforeafter-before] img")?.src,afterImg:p.querySelector("[data-fls-beforeafter-after] img")?.src,title:p.querySelector(".post__title")?.textContent,content:p.querySelector(".post__content")?.innerHTML},typeof window.flsPopup<"u"?window.flsPopup.open("popup_blog"):a())}});
